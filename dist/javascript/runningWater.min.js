/*! hellowWorld 2015-06-24 */
(function(t){function e(t){this.itemHtml=t||h}function i(t){this.num=0,this.rowNum=5,this.xList=[],this.yList=[],this.rowWidth=t.element.width(),this.oneXwidth=this.rowWidth/this.rowNum,this.element=t.element,this.RunningWater=new e,this.element.addClass("water-running");for(var i=0;this.rowNum>i;i++)this.xList.push(i*this.oneXwidth),this.yList.push(0)}function n(){for(var e,i,n,s=this.num,a=0,o=this.element.children().slice(s),h=0,c=o.length;c>h;h++)a=r(this.yList),e=this.yList[a],i=this.xList[a],t(o[h]).css({top:e+"px",left:i}),n=t(o[h]).find("img").eq(0).attr("src"),this.yList[a]=e+t(o[h]).height()+20}function r(t){if(!t instanceof Array)throw Error("Function getMinIndex:need a argument of array");for(var e=t.length-1,i=t.length-2;i>=0;i--)t[i]<=t[e]&&(e=i);return e}function s(){for(var e=this.num,i=this.element.children().slice(e),n=0,r=i.length;r>n;n++)t(i[n]).css({visibility:"visible"})}function a(){this.element.css({height:Math.max.apply(Math,this.yList)+"px"})}function o(e){var i=e||{};return i.element=t(this),i}if(!(t instanceof Object))throw Error("本流水布局插件依赖于jq框架请先加载jq框架");var h="<div class='water-running-block' style='visibility:hidden;'><img src='{image}'><div class='message-content'><h4>{header}</h4><p class=''>{context}</p></div></div>";e.prototype.append=function(e){if(!e instanceof Object)throw Error("data is not a Object:data={image:value,header:value,context:value}");var i,n=this.itemHtml;if("string"==typeof e.image&&(n=n.replace(/{image}/gi,e.image)),"string"==typeof e.header&&(n=n.replace(/{header}/gi,e.header)),("string"==typeof e.context||"number"==typeof e.context)&&(n=n.replace(/{context}/gi,e.context)),e.context instanceof Object&&!e.context instanceof Array){i=e.context;for(var r in i)n=n.replace(RegExp("{"+r+"}","ig"),i[r])}if(e.context instanceof Array){var s,a,o=/\[([\S\s]+)\]/gi,h="";if(n=n.replace(/\[[\S\s]+\]/gi,"{stance}"),i=e.context,null===o.exec(n))throw Error("Object RunningWater Function append:'定义了context数据为数组对象，未在模板中指定替换对象'");a=o.exec(n)[1];for(var c=0,l=i.length;l>c;c++){if(s=a,"object"===t.type(i[c])){for(var r in i[c])s=s.replace(RegExp("{"+r+"}","ig"),i[c][r]);console.log(s),h+=s}if(("number"==typeof i[c]||"string"==typeof i[c])&&(h+=a.replace(RegExp("{value}","ig"),i[c])),i[c]instanceof Array){for(var p=0,f=i[c].length;f>p;p++)s=s.replace(RegExp("{["+p+"]}","ig"),i[c][p]);h+=s}}n=n.replace(/{stance}/gi,h)}return n},i.prototype.appendBlocks=function(t){var e="";if(!t instanceof Array)throw Error("Function appendBlocks need a array of data object");for(var i=0,r=t.length;r>i;i++)e+=this.RunningWater.append(t[i]);this.element.append(e),n.apply(this),s.apply(this),a.apply(this),this.num=this.element.children().length},i.prototype.init=function(){this.element.children().css({visibility:"hidden"}),n.apply(this),s.apply(this),a.apply(this),this.num=this.element.children().length},t.fn.runningWater=function(t,e){var n,r;if(0===this.length)throw Error("未获得有效的dom对象");return n=o.call(this,t),r=new i(n),r.init(),e(),r}})(jQuery);